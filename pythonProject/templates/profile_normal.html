<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Профиль аккаунта CRM</title>
    <link rel="stylesheet" href="/static/styles/profile_normal.css">
    <style>
        /* Скрыть таблицу по умолчанию */
        table {
            display: none;
        }

        /* Стили для кнопки "Паспорт" */
        #showTableButton {
            background-color: #4CAF50; /* Зеленый цвет */
            color: white;
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }

        /* При наведении добавляем немного тени */
        #showTableButton:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body id="userTable">
    <header>
        <h1>Профиль аккаунта CRM</h1>
    </header>
    <div>
        <div class="user-window">
            <div class="search-bar">
                <input id="searchInput" type="text" placeholder="Поиск пользователя...">
                <button class="admin-button" onclick="searchUser()">Найти</button>
            </div>

            <!-- Таблица с данными -->
            <table border="1" id="dataTable">
                <thead>
                    <tr>
                        {% for column in columns %}
                            <th>{{ column }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for person in users %}
                        <tr>
                            {% for value in person %}
                                <td>{{ value }}</td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
            <!-- Код для отображения профиля пользователя -->
            <!-- Добавим форму и кнопку для отображения всех таблиц -->
            <form method="post" action="">
                <button type="button" onclick="AllTables()">Отобразить все таблицы</button>
            </form>

            <!-- Отображение всех таблиц -->
            {% if all_tables %}
                <h2>Список всех таблиц в базе данных</h2>
                <ul>
                    {% for table in all_tables %}
                        <li>{{ table }}</li>
                    {% endfor %}
                </ul>
            {% endif %}

            <section>
                <div class="profile-container">
                    <!-- Остальной контент вашей страницы -->
                    <img class="profile-image" src="/static/img/avatar.jpg" alt="Аватар пользователя">
                    <div class="profile-info">
                        <label>ФИО:</label> {{user[4] + " " + user[5] + " " + user[6]}}<br>
                        <label>Email:</label> {{user[11]}}<br>
                        <label>Телефон:</label> {{user[10]}}<br>
                        <label>Информация о грейде:</label>{{grade[1]}}<br>
                        <label>Позиция в департаменте:</label>{{depart_position[3]}}<br>
                        <label>Департамент:</label>{{department[1]}}<br>
                        <button class="documents-btn" onclick="openModal()">Документы</button>
                    </div>
                    <button class="logout-btn" onclick="logout()">Выйти</button>
                </div>
            </section>
        </div>
    </div>
    <!-- Модальное окно с информацией о документах -->
    <div id="modal" class="modal" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h2>Информация о документах</h2>
            <table>
                <tr>
                    <td>Образование:</td>
                    <td>{{diploma[2]}}</td>
                </tr>
                <tr>
                    <td></td>
                    <td>{{diploma[3]}}</td>
                </tr>
                <tr>
                    <td></td>
                    <td>{{diploma[4]}}</td>
                </tr>
                <tr>
                    <td></td>
                    <td>{{diploma[5]}}</td>
                </tr>
                <tr>
                    <td></td>
                    <td>{{diploma[6]}}</td>
                </tr>
            </table>
            <p>Медицинские справки: {{user[15]}}</p>
            <p>Сертификаты: {{achievments[1]}}</p>
            <span class="close" onclick="closeModal()">&#10006;</span>
        </div>
    </div>

    <script>
        // JavaScript-функция для отображения/скрытия таблицы
        function showTable() {
            var table = document.getElementById("dataTable");
            if (table.style.display === "none") {
                table.style.display = "table";
            } else {
                table.style.display = "none";
            }
        }

        // Остальные JavaScript-функции вашей страницы
        function searchUser() {
            var searchTerm = document.getElementById('searchInput').value;
            var data = { term: searchTerm };
            fetch('/profile_normal', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
            .then(response => response.text())
            .then(html => {
                document.getElementById('userTable').outerHTML = html;
            });
        }

        function AllTables() {
            fetch('/get_all_tables', {
                method: 'POST',
            })
            .then(response => response.text())
            .then(html => {
                document.getElementById('userTable').outerHTML = html;
            });
        }

        function showInfo(userId) {
            location.href = '/profile_user/' + String(userId);
        }

        function openModal() {
            document.getElementById('modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target == document.getElementById('modal')) {
                closeModal();
            }
        }

        function logout() {
            var confirmLogout = confirm("Вы уверены, что хотите выйти?");
            if (confirmLogout) {
                window.location.href = '/logout';
            } else {
                // Можно добавить дополнительные действия, если нужно
            }
        }
    </script>
</body>
</html>
